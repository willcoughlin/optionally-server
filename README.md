# OptionAlly Server
## Contents
* [Description](#description)
* [Technologies](#technologies)
* [Schema](#schema)
* [Examples](#examples)
* [Source Code](#source-code)
* [Attributions](#attributions)

## Description
This is the server which makes OptionAlly possible, providing market data through an intuitive GraphQL API.

## Technologies
<div style="display: flex; justify-content: space-evenly">
  <a href="https://www.typescriptlang.org/">
    <img src="./assets/ts-logo-128.svg" width="64" alt="TypeScript Logo">
  </a>
  <a href="https://graphql.org/">
    <img src="./assets/GraphQL_Logo.svg" width="64" alt="GraphQL Logo">
  </a>
  <a href="https://nodejs.org/en/">
    <img src="./assets/node-js-brands.svg" width="64" alt="Node.js Logo">
  </a>
</div>

OptionAlly Server is built with:
- [TypeScript](https://www.typescriptlang.org/)
- [GraphQL](https://graphql.org/) + [Apollo Server](https://www.apollographql.com/docs/apollo-server/)
- [Node.js](https://nodejs.org/en/) + [Express](https://expressjs.com/)
  
## Schema
See below for an abridged version of the GraphQL schema. You can view the full version at [/src/graphql/schema.graphql](/src/graphql/schema.graphql).
### Queries
```graphql
type Query {
  stock(symbol: String!): Stock
}
```

### Types
```graphql
type Stock implements Tradable {
  bid: Float!
  ask: Float!
  last: Float!
  symbol: String!
  optionsChain: [OptionsForExpiry!]
}

type Option implements Tradable {
  bid: Float!
  ask: Float!
  last: Float!
  strike: Float!
  expiry: String!
  type: OptionType!  # CALL or PUT
  underlyingSymbol: String!
}

type OptionsForExpiry {
  expiry: String!
  calls: [Option!]!
  puts: [Option!]!
}
```

## Examples
Now that we've seen the schema, let's see some queries in action.

### Get price data for $SPY
Request:
```graphql
{
  stock(symbol: "SPY") {
    symbol
    bid
    ask
    last
  }
}
```

Response:
```json
{
  "data": {
    "stock": {
      "symbol": "SPY",
      "bid": 320.15,
      "ask": 320.3,
      "last": 320.85
    }
  }
}
```

### Get put option data for $TSLA
Request:
```graphql
{
  stock(symbol: "TSLA") {
    optionsChain {
      expiry
      puts {
        underlyingSymbol
        last
        strike,
        expiry,
      }
    }
  } 
}
```

Response:
```json
{
  "data": {
    "stock": {
      "optionsChain": [
        {
          "expiry": "2020-07-31",
          "puts": [
            {
              "underlyingSymbol": "TSLA",
              "last": 0.01,
              "strike": 100,
              "expiry": "2020-07-31"
            },
            {
              "underlyingSymbol": "TSLA",
              "last": 0.01,
              "strike": 150,
              "expiry": "2020-07-31"
            },

            ...
          
          ]
        }
        
        ...
      
      ]
    }
  }
}
```

## Source Code
Let's break down the source code, shall we?
### [src/server.ts](src/server.ts)
Here is the application entry point. It contains configuration for the Apollo and Express servers. Not much else to see here.

### [src/graphql](src/graphql)
In this directory is all the GraphQL-related TypeScript code, as well as the schema definition file.

#### [src/graphql/resolvers.ts](src/graphql/resolvers.ts)
Definitions for all neccessary resolvers.

#### [src/graphql/schema.ts](src/graphql/schema.ts)
Creation of the executable `GraphQLSchema` with typedefs and resolvers.

#### [src/graphql/types.ts](src/graphql/types.ts)
GraphQL type definitions generated by [GraphQL Code Generator](https://graphql-code-generator.com/). <small>(Thanks so much â™¥!)</small>

#### [src/graphql/schema.graphql](src/graphql/schema.graphql)
 *See section [Schema](#schema) for details*.

### [src/datasource](src/datasource)
This project utilizes [Apollo REST Data Source](https://www.npmjs.com/package/apollo-datasource-rest) from the Apollo Server Project to provide resolvers access to data from REST APIs. In this directory is the interface definition and implementation for the REST data source.

#### [src/datasource/IStocksApi.ts](src/datasource/IStocksApi.ts)
Defines two market data retrieval functions for our resolvers:
- `getStock` for getting stock price.
- `getOptions` for getting an underlying stock's options chain.

### [src/datasource/opc-stocks-api/OPCStocksApi.ts](src/datasource/opc-stocks-api/OPCStocksApi.ts)
Implements `IStocksApi` with [OptionsProfitCalculator.com](https://OptionsProfitCalculator.com) data.


## Attributions
* The TypeScript Logo is attributed to Microsoft, licensed under the [Apache License 2.0](http://www.apache.org/licenses/LICENSE-2.0).
* The GraphQL Logo is attributed to <a href="https://commons.wikimedia.org/wiki/File:GraphQL_Logo.svg" title="via Wikimedia Commons">Facebook</a>, licensed under the <a href="http://opensource.org/licenses/bsd-license.php">BSD License</a>. Icon is not modified.
* The icon *node-js-brands* is attributed to [FontAwesome](https://fontawesome.com), licensed under [Creative Commons Attribution 4.0 International license](https://fontawesome.com/license). Icon is not modified. Node.js is a trademark of the [OpenJS Foundation](https://openjsf.org/)